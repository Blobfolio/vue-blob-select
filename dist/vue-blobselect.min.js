!function(){const e={data:function(){return{focus:0,init:!1,minItemKey:0,maxItemKey:0,searchValue:"",state:"closed",timeout:null}},props:{id:{type:String,default:""},name:{type:String,default:""},value:{type:[Number,String,Array],default:0},items:{type:Array,default:[]},disabled:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},placeholder:{type:Boolean,default:!1},required:{type:Boolean,default:!1},search:{type:Boolean,default:!1},sort:{type:String,default:""},fieldPlaceholder:{type:String,default:"---"},labelPlaceholder:{type:String,default:"---"},labelType:{type:String,default:"string"},valueType:{type:String,default:"string"}},methods:{toggleState:function(e){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.state="open"),this.disabled?e="closed":(!e||"open"!==e&&"closed"!==e)&&(e="closed"===this.state?"open":"closed"),e!==this.state)if("open"===e){h(this.$el),this.state="opening";let e=this;this.timeout=setTimeout(function(){if(e.state="open",e.timeout=null,e.search){const t=e.$el.querySelector(".blobselect-item-search");t.innerHTML=e.searchValue,d(t)}e.resetFocus()},50)}else this.state="closed",this.$el.focus()},toggleKeyState:function(e){const t=e.keyCode,s=c[t]||!1;if("open"!==this.state)(!s||"tab"!==s&&"backspace"!==s)&&(e.stopPropagation(),this.search&&b(t)&&(this.searchValue+=String.fromCharCode(t).toLowerCase(),this.$el.querySelector(".blobselect-item-search").textContent=this.searchValue),"closed"===this.state&&this.toggleState("open"));else if("escape"===s)e.stopPropagation(),this.toggleState("closed");else if("enter"===s)e.stopPropagation(),e.preventDefault(),e.target.classList.contains("blobselect-item-search")?this.selectFirst():this.selectFocused();else if(-1!==["tab","up","down","left","right"].indexOf(s)){if(e.target.classList.contains("blobselect-item-search")&&("left"===s||"right"===s))return!0;e.stopPropagation(),"left"===s||"up"===s?this.traverseItems("back"):this.traverseItems("next")}else this.search&&e.target.classList.contains("blobselect-item-search")&&this.toggleFilter()},toggleFilter:function(e,t,s){let i,l,n,o,r=!0;function a(){n=e.apply(l||this,i||[]),l=i=null,r=!0}function c(){o&&(clearTimeout(o),o=null)}function u(){l=this,i=arguments,s?r&&(r=!1,o=setTimeout(a,t)):(c(),o=setTimeout(a,t))}return u.cancel=c,u}(function(){if(!this.search)return;const e=this.$el.querySelector(".blobselect-item-search");if(null===e)return;this.searchValue=e.textContent.replace(/\s{1,}/g," ").trim(),-1!==this.focus&&(this.focus=-1,this.resetFocus());let s={},i=new Set;if(this.searchValue){const e=this.niceItems,t=e.length,l=RegExp(p(this.searchValue),"i"),n=RegExp(p(this.searchValue),"gi");for(let o=0;o<t;++o)l.test(e[o].label)&&(s[e[o].label]={label:e[o].label,richLabel:f(e[o].label).replace(n,"<mark>$&</mark>")},i.add(e[o].label))}const l=this.$el.querySelectorAll(".blobselect-item"),n=l.length,o=0<i.size;for(let r=0;r<n;++r){const e=t(JSON.parse(l[r].getAttribute("data-blob-label"))||!1,this.niceLabelType);if(i.has(e))l[r].classList.contains("is-match")||l[r].classList.add("is-match"),l[r].classList.contains("is-not-match")&&l[r].classList.remove("is-not-match"),l[r].innerHTML=s[e].richLabel;else{let t=!1;l[r].classList.contains("is-match")&&(l[r].classList.remove("is-match"),t=!0),o?l[r].classList.contains("is-not-match")||l[r].classList.add("is-not-match"):l[r].classList.contains("is-not-match")&&l[r].classList.remove("is-not-match"),t&&(l[r].textContent=e)}}},150),traverseItems:function(e){let t=this.getItemKey(e);t!==this.focus&&(this.focus=t,this.triggerFocus())},getItemKey:function(e){if(!this.minItemKey&&!this.maxItemKey)return-1;if("current"===e){const e=this.$el.querySelector(".blobselect-item.is-selected");if(null!==e){const t=parseInt(e.getAttribute("data-blob-item"))||0;if(t)return t}return this.getItemKey("first")}const t=this.$el.querySelectorAll(".blobselect-item:not(.is-disabled):not(.is-not-match)"),s=t.length;if(!s)return-1;let i=[];for(let a=0;a<s;++a){let e=parseInt(t[a].getAttribute("data-blob-item"))||0;i.push(e)}i.sort(function(e,t){return e-t});const l=i.length;let n=0;const o=i[0],r=i[l-1];if(1===l)return o;switch(e){case"next":if((n=this.focus+1)>r)return o;if(n===r)return r;for(let e=0;e<l;++e)if(i[e]>=n)return i[e];return o;case"back":if((n=this.focus-1)<o)return r;if(n===o)return o;for(let e=l-1;0<=e;--e)if(i[e]<=n)return i[e];return r;case"first":return o;case"last":return r}return-1},resetFocus:function(){if(0<=this.focus){let e=this.search?-1:this.getItemKey("first");e!==this.focus&&(this.focus=e,this.triggerFocus())}},triggerFocus:function(){if(0>this.focus)this.search&&this.$el.querySelector(".blobselect-item-search").focus();else{let e=this.search?this.focus+1:this.focus;const t=this.$el.querySelector('.blobselect-item[data-blob-item="'+e+'"]');null!==t?t.focus():(this.focus=-1,this.search&&this.$el.querySelector(".blobselect-item-search").focus())}},itemsClick:function(e){if(e.target.classList.contains("blobselect-item"))return e.preventDefault(),this.toggleFieldSelection(e.target);let t=e.target;for(;t.parentNode&&"classList"in t.parentNode;){if((t=t.parentNode).classList.contains("blobselect-item"))return this.toggleFieldSelection(t);if(t.classList.contains("blobselect"))return}},toggleFieldSelection:function(e){if(!e.classList.contains("blobselect-item")||e.classList.contains("is-disabled"))return;const s=t(JSON.parse(e.getAttribute("data-blob-value"))||!1,this.niceValueType);this.toggleValueSelection(s)},toggleValueSelection:function(e){e=t(e||"",this.niceValueType);let s=!1,i=u(this.value);if(this.multiple){let t=i.indexOf(e);-1!==t?(i.splice(t,1),s=!0):e&&(i.push(e),i.sort(),s=!0)}else e!==i&&(i=e,s=!0);s&&this.$emit("input",i);let l=this;Vue.nextTick(function(){"open"!==l.state||e&&!l.niceValue.has(e)||l.toggleState("closed")})},selectFirst:function(){let e=this.getItemKey("first");if(0>e)return;const t=this.$el.querySelector('.blobselect-item[data-blob-item="'+e+'"]');null!==t&&this.toggleFieldSelection(t)},selectFocused:function(){const e=this.$el.querySelector(".blobselect-item.is-focused");null!==e&&this.toggleFieldSelection(e)}},computed:{niceName:function(){let e=this.name;return e&&"string"==typeof e||(e="blobselect"),this.multiple&&"[]"!==e.substr(-2)&&(e+="[]"),e},niceId:function(){let e=this.id;return e&&"string"==typeof e||(e=this.niceName.replace(/[\[\]]/g,"")),e},niceLabelType:function(){return this.labelType&&"string"==typeof this.labelType&&"num"===this.labelType.toLowerCase().substr(0,3)?"number":"string"},niceValueType:function(){return this.valueType&&"string"==typeof this.valueType&&"num"===this.valueType.toLowerCase().substr(0,3)?"number":"string"},nicePlaceholderValue:function(){return"string"===this.niceValueType?"":0},nicePlaceholderLabel:function(){return"string"===this.niceLabelType?"":0},niceValue:function(){let e;const s=this.itemValues,i=JSON.stringify(this.value);if(this.multiple){if(e=[],Array.isArray(this.value))for(let i=0;i<this.value.length;++i){let l=t(this.value[i],this.niceValueType);l&&-1===e.indexOf(l)&&s.has(l)&&e.push(l)}e.sort()}else(e=t(this.value,this.niceValueType))&&!s.has(e)&&(e=this.nicePlaceholderValue);if(JSON.stringify(e)!==i&&this.$emit("input",e),!this.multiple){if(e===this.nicePlaceholderValue)return new Set;e=[e]}return new Set(e)},valueHash:function(){if(!this.init)return 0;let e=Array.from(this.niceValue);return e.sort(),l(e)},niceItems:function(){if(!Array.isArray(this.items))return[];const e=this.items.length;let s=[],l=new Set;for(let n=0;n<e;++n){let e={group:"",label:this.nicePlaceholderLabel,value:this.nicePlaceholderValue,disabled:this.disabled,placeholder:!1};"object"==typeof this.items[n]?(this.items[n].group&&(e.group=i(this.items[n].group)),e.label=t(this.items[n].label,this.niceLabelType),e.value=t(this.items[n].value,this.niceValueType),!e.label&&e.value&&(this.niceLabelType!==this.niceValueType?e.label=t(e.value,this.niceLabelType):e.label=e.value),!e.disabled&&this.items[n].disabled&&(e.disabled=!0)):(e.value=t(this.items[n],this.niceValueType),e.value&&(this.niceLabelType!==this.niceValueType?e.label=t(e.value,this.niceLabelType):e.label=e.value)),e.value&&!l.has(e.value)&&(l.add(e.value),s.push(e))}return s},itemValues:function(){let e=this.enabledItems.map(function(e){return e.value});return e.sort(),new Set(e)},enabledItems:function(){return this.niceItems.filter(function(e){return!e.disabled})},groupedItems:function(){let e=this.niceItems.filter(function(e){return!!e.group});const t=e.length;if(!t)return!1;let s={},i=new Set;for(let l=0;l<t;++l){let t=e[l].group;i.has(t)||(i.add(t),s[t]=[]),s[t].push(e[l])}if(this.sortDirection){let e=Object.keys(s),t=e.length;for(let i=0;i<t;++i)s[e[i]].sort(this.sortFunction)}return s},ungroupedItems:function(){let e=this.niceItems.filter(function(e){return!e.group});return!!e.length&&(this.sortDirection&&e.sort(this.sortFunction),e)},selectedItems:function(){const e=this.niceValue,t=this;let s=this.enabledItems.filter(function(t){return e.has(t.value)}).map(function(e){return{label:e.placeholder?t.fieldPlaceholder:e.label,value:e.value,class:"blobselect-selection"+(e.placeholder?" is-placeholder":"")}});return this.sortDirection&&s.sort(this.sortFunction),s},hasSelections:function(){return 0<this.selectedItems.length},selectHtml:function(){let e="";const t=this.niceValue;!this.placeholder||this.multiple||this.required||(e+='<option value="'+this.nicePlaceholderValue+'">'+f(this.labelPlaceholder)+"</option>");const s=this.groupedItems;if(!1!==s){let i=Object.keys(this.groupedItems);const l=i.length;this.sortDirection&&(i.sort(),"DESC"===this.sortDirection&&i.reverse());for(let n=0;n<l;++n){e+='<optgroup label="'+f(i[n])+'">';const l=s[i[n]].length;for(let o=0;o<l;++o)e+='<option value="'+f(s[i[n]][o].value)+'"',s[i[n]][o].disabled&&(e+=" disabled"),t.has(s[i[n]][o].value)&&(e+=" selected"),e+=">"+f(s[i[n]][o].label)+"</option>";e+="</optgroup>"}}const i=this.ungroupedItems;if(!1!==i){const s=i.length;for(let l=0;l<s;++l)e+='<option value="'+f(i[l].value)+'"',i[l].disabled&&(e+=" disabled"),t.has(i[l].value)&&(e+=" selected"),e+=">"+f(i[l].label)+"</option>"}return e},itemsHtml:function(){let e="";this.search&&(e+='<div class="blobselect-item-search" type="text" contentEditable tabIndex="0"></div>');let t=0;if(this.placeholder&&!this.multiple&&!this.required){++t;let s=this.labelPlaceholder,i=this.nicePlaceholderValue;e+='<div class="'+["blobselect-item","is-placeholder"].join(" ")+'" tabIndex="'+t+'" data-blob-item="'+t+'" data-blob-value="'+f(JSON.stringify(i))+'" data-blob-label="'+f(JSON.stringify(s))+'">'+f(s)+"</div>"}const s=this.groupedItems;if(!1!==s){let i=Object.keys(this.groupedItems);const l=i.length;this.sortDirection&&(i.sort(),"DESC"===this.sortDirection&&i.reverse());for(let n=0;n<l;++n){e+='<div class="blobselect-item-group">'+f(i[n])+"</div>";const l=s[i[n]].length;for(let o=0;o<l;++o){++t;let l=s[i[n]][o].label,r=s[i[n]][o].value,a=["blobselect-item","has-group"];s[i[n]][o].disabled&&a.push("is-disabled"),s[i[n]][o].placeholder&&a.push("is-placeholder"),e+='<div class="'+a.join(" ")+'" tabIndex="'+t+'"',e+=' data-blob-item="'+t+'"',e+=' data-blob-value="'+f(JSON.stringify(r))+'" data-blob-label="'+f(JSON.stringify(l))+'">'+f(l)+"</div>"}}}const i=this.ungroupedItems;if(!1!==i){const s=i.length;for(let l=0;l<s;++l){++t;let s=i[l].label,n=i[l].value,o=["blobselect-item"];i[l].disabled&&o.push("is-disabled"),i[l].placeholder&&o.push("is-placeholder"),e+='<div class="'+o.join(" ")+'" tabIndex="'+t+'"',e+=' data-blob-item="'+t+'"',e+=' data-blob-value="'+f(JSON.stringify(n))+'" data-blob-label="'+f(JSON.stringify(s))+'">'+f(s)+"</div>"}}return t?(this.minItemKey=1,this.maxItemKey=t):(this.minItemKey=0,this.maxItemKey=0),this.init||(this.init=!0),e},sortDirection:function(){return!(!this.sort||"string"!=typeof this.sort)&&("D"===this.sort.toUpperCase().substr(0,1)?"DESC":"ASC")},sortFunction:function(){if(!1===this.sortDirection)return!1;switch(this.niceLabelType+this.sortDirection){case"numberASC":return r;case"numberDESC":return a;case"stringASC":return n;case"stringDESC":return o}return!1},stateClass:function(){return this.state&&"closed"!==this.state?"is-"+this.state:"is-closed"}},watch:{focus:function(e){const t=this.$el.querySelectorAll(".blobselect-item.is-focused");for(let s=0;s<t.length;++s)t[s].classList.remove("is-focused");if(0<e){const t=this.$el.querySelector('.blobselect-item[data-blob-item="'+e+'"]');null!==t&&t.classList.add("is-focused")}},valueHash:function(){if(!this.niceValue.size){const e=this.$el.querySelectorAll(".blobselect-item.is-active"),t=e.length;if(t)for(let l=0;l<t;++l)!e[l].classList.contains("is-disabled")&&e[l].classList.contains("is-placeholder")||e[l].classList.remove("is-active");const s=this.$el.querySelectorAll(".blobselect-item.is-placeholder:not(.is-active):not(.is-disabled)"),i=s.length;for(let l=0;l<i;++l)s[l].classList.add("is-active");return}const e=this.$el.querySelectorAll(".blobselect-item"),s=e.length,i=this.niceValue;let l=!1;for(let n=0;n<s;++n)l&&!this.multiple||e[n].classList.contains("is-disabled")||!i.has(t(JSON.parse(e[n].getAttribute("data-blob-value"))||!1,this.niceValueType))?e[n].classList.contains("is-active")&&e[n].classList.remove("is-active"):(e[n].classList.contains("is-active")||e[n].classList.add("is-active"),l=!0)}},template:'<div class="blobselect" v-on:keyup="toggleKeyState($event)" :tabIndex.prop="0" v-on:click.self="toggleState" :class="[ stateClass, { \'is-disabled\' : disabled, \'is-required\' : required, \'is-multiple\' : multiple }]" >\t\t\t<div class="blobselect-selections" v-if="multiple" v-on:click.self.prevent="toggleState">\t\t\t\t<div v-if="hasSelections" v-for="item in selectedItems" v-on:click.prevent="toggleValueSelection(item.value)" :class="item.class">{{ item.label }}</div>\t\t\t\t<div v-if="!hasSelections && placeholder" class="blobselect-selection is-placeholder" v-on:click.prevent="toggleState">{{ fieldPlaceholder }}</div>\t\t\t</div>\t\t\t<div class="blobselect-selections" v-else v-on:click.prevent="toggleState">\t\t\t\t<div v-if="hasSelections" v-for="item in selectedItems" :class="item.class">{{ item.label }}</div>\t\t\t\t<div v-if="!hasSelections && placeholder" class="blobselect-selection is-placeholder">{{ fieldPlaceholder }}</div>\t\t\t</div>\t\t\t<select v-on:click.self="toggleState" :multiple="multiple" :disabled="disabled" :required="required" :name="niceName" :id="niceId" v-html="selectHtml" v-on:input="$emit(\'input\', $event.target.value)"></select>\t\t\t</select>\t\t\t<div class="blobselect-button" v-on:click.prevent="toggleState"></div>\t\t\t<div class="blobselect-items" v-on:click="itemsClick($event)" v-html="itemsHtml"></div>\t\t</div>'},t=function(e,t){return"number"===t?s(e):i(e)},s=function(e){if(!e||"boolean"==typeof e)return e?1:0;if("number"!=typeof e)try{e=Number(e)||0}catch(t){e=0}return e},i=function(e){if(!e||"boolean"==typeof e)return e?"true":"";if("string"!=typeof e)try{e=String(e)}catch(t){e=""}return e},l=function(e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){return 0}else try{e+=""}catch(e){return 0}let t=0;const s=e.length;for(let i=0;i<s;++i){t=(t<<5)-t+e.charCodeAt(i),t&=t}return t},n=function(e,t){if(e.placeholder===t.placeholder){let s=e.label.toLowerCase(),i=t.label.toLowerCase();return s===i?0:s<i?-1:1}return e.placeholder?-1:1},o=function(e,t){if(e.placeholder===t.placeholder){let s=e.label.toLowerCase(),i=t.label.toLowerCase();return s===i?0:s>i?-1:1}return e.placeholder?-1:1},r=function(e,t){if(e.placeholder===t.placeholder){let s=Number(e.label.replace(/[^\d.]/g,""))||0,i=Number(t.label.replace(/[^\d.]/g,""))||0;return s===i?0:s<i?-1:1}return e.placeholder?-1:1},a=function(e,t){if(e.placeholder===t.placeholder){let s=Number(e.label.replace(/[^\d.]/g,""))||0,i=Number(t.label.replace(/[^\d.]/g,""))||0;return s===i?0:s>i?-1:1}return e.placeholder?-1:1},c={8:"backspace",9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down"},u=function(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},h=function(e){const t=document.querySelectorAll(".blobselect.is-open");for(let s=0;s<t.length;++s)e&&e===t[s]||void 0!==t[s].__vue__&&t[s].__vue__.toggleState("close")},d=function(e){let t,s=document.createRange();s.selectNodeContents(e),s.collapse(!1),(t=window.getSelection()).removeAllRanges(),t.addRange(s)},f=function(e){return"string"!=typeof e&&(e=i(e)),e.replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},b=function(e){return 47<e&&58>e||64<e&&91>e||95<e&&112>e||185<e&&193>e||218<e&&223>e},p=function(e){try{return(e+="").replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}catch(e){return""}};document.documentElement.addEventListener("click",function(e){if("matches"in e.target){if(e.target.matches(".blobselect"))return!0;let t=e.target;for(;t.parentNode&&"matches"in t.parentNode;)if((t=t.parentNode).matches(".blobselect"))return!0;h()}return!0}),"undefined"!=typeof window&&window.Vue&&window.Vue.component("blob-select",e)}();