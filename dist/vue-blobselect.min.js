!function(){const e={data:function(){return{focus:0,init:!1,searchValue:"",state:"closed",timeout:null}},props:{id:{type:String,default:""},name:{type:String,default:""},value:{type:[Number,String,Array],default:0},items:{type:Array,default:[]},disabled:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},placeholder:{type:Boolean,default:!1},required:{type:Boolean,default:!1},search:{type:Boolean,default:!1},sort:{type:String,default:""},fieldPlaceholder:{type:String,default:"---"},labelPlaceholder:{type:String,default:"---"},labelType:{type:String,default:"string"},valueType:{type:String,default:"string"}},methods:{toggleState:function(e){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.state="open"),this.disabled?e="closed":(!e||"open"!==e&&"closed"!==e)&&(e="closed"===this.state?"open":"closed"),e!==this.state)if("open"===e){h(this.$el),this.state="opening";let e=this;this.timeout=setTimeout(function(){if(e.state="open",e.timeout=null,e.search){const t=e.$el.querySelector(".blobselect-item-search");t.innerHTML=t.textContent.replace(/\s{1,}/g," ").trim(),u(t)}e.resetFocus()},50)}else this.state="closed",this.$el.focus()},toggleKeyState:function(e){const t=e.keyCode,s=c[t]||!1;if("open"!==this.state)(!s||"tab"!==s&&"backspace"!==s)&&(e.stopPropagation(),this.search&&d(t)&&(this.searchValue+=String.fromCharCode(t).toLowerCase(),this.$el.querySelector(".blobselect-item-search").textContent=this.searchValue),"closed"===this.state&&this.toggleState("open"));else if("escape"===s)e.stopPropagation(),this.toggleState("closed");else if("enter"===s)e.stopPropagation(),e.preventDefault(),e.target.classList.contains("blobselect-item-search")?this.selectFirst():this.selectFocused();else if(-1!==["tab","up","down","left","right"].indexOf(s)){if(e.target.classList.contains("blobselect-item-search")&&("left"===s||"right"===s))return!0;e.stopPropagation(),"left"===s||"up"===s?this.traverseItems("back"):this.traverseItems("next")}},traverseItems:function(e){let t=this.getItemKey(e);t!==this.focus&&(this.focus=t,this.triggerFocus())},getItemKey:function(e){if("current"===e){for(let e=0;e<this.blobItems.length;++e)if(this.blobItems[e].selected&&!this.blobItems[e].disabled)return e;return this.getItemKey("first")}let t=0,s=this.blobItems.length-1,i=1;if(0>s)return-1;if("next"===e)(t=this.focus+1)>s&&(t=0);else if("back"===e){if(s=0,i=-1,0>(t=this.focus-1))return-1}else"last"===e&&(t=this.blobItems.length-1,s=0,i=-1);if(0<i){for(let e=t;e<=s;++e)if(!this.blobItems[e].disabled&&"blobselect-item-group"!==this.blobItems[e].class&&-1===this.blobItems[e].class.indexOf("is-not-match"))return e;return"next"===e?this.getItemKey("first"):-1}for(let e=t;s<=e;--e)if(!this.blobItems[e].disabled&&"blobselect-item-group"!==this.blobItems[e].class&&-1===this.blobItems[e].class.indexOf("is-not-match"))return e;return this.search||"back"!==e?-1:this.getItemKey("last")},resetFocus:function(){if(0<=this.focus){let e=this.search?-1:this.getItemKey("first");e!==this.focus&&(this.focus=e,this.triggerFocus())}},triggerFocus:function(){if(0>this.focus)this.search&&this.$el.querySelector(".blobselect-item-search").focus();else{let e=this.search?this.focus+1:this.focus;try{this.$el.querySelector(".blobselect-items").children[e].focus()}catch(e){console.warn("DOM mutations prevented focus from being transferred.")}}},toggleSelection:function(e){e=t(e,this.niceValueType);let s=a(this.value),i=!1;if(this.multiple){let t=s.indexOf(e);if(-1!==t?(s.splice(t,1),i=!0):-1!==this.niceValues.indexOf(e)&&(s.push(e),s.sort(),i=!0),1<s.length){s.length!==(s=s.filter(Boolean)).length&&(i=!0)}}else e!==s&&-1!==this.niceValues.indexOf(e)&&(s=e,i=!0);i&&this.$emit("input",s),"open"===this.state&&-1!==this.niceValues.indexOf(e)&&this.toggleState("closed")},selectFirst:function(){let e=this.getItemKey("first");if(0>e)return;let t=this.blobItems[e].value,s=a(this.value),i=!1;this.multiple&&-1===s.indexOf(t)?(s.push(t),s.sort(),i=!0):this.multiple||t===s||(s=t,i=!0),i&&this.$emit("input",s),"open"===this.state&&this.toggleState("closed")},selectFocused:function(){if(0>this.focus||this.focus>=this.blobItems.length)return void this.selectFirst();if(this.blobItems[this.focus].disabled)return;let e=a(this.value),t=this.blobItems[this.focus].value,s=!1;this.multiple&&-1===e.indexOf(t)?(e.push(t),e.sort(),s=!0):this.multiple||t===e||(e=t,s=!0),s&&this.$emit("input",e),"open"===this.state&&this.toggleState("closed")},toggleFilter:function(e){this.searchValue=e.replace(/\s{1,}/g," ").trim(),this.resetFocus()}},computed:{niceName:function(){let e=this.name;return e&&"string"==typeof e||(e="blobselect"),this.multiple&&"[]"!==e.substr(-2)&&(e+="[]"),e},niceId:function(){let e=this.id;return e&&"string"==typeof e||(e=this.niceName.replace(/[\[\]]/g,"")),e},niceLabelType:function(){return this.labelType&&"string"==typeof this.labelType&&"num"===this.labelType.toLowerCase().substr(0,3)?"number":"string"},niceValueType:function(){return this.valueType&&"string"==typeof this.valueType&&"num"===this.valueType.toLowerCase().substr(0,3)?"number":"string"},niceValue:function(){let e=[];if(this.init)if(this.multiple&&Array.isArray(this.value)){for(let s=0;s<this.value.length;++s){let i=t(this.value[s],this.niceValueType);i&&-1===e.indexOf(i)&&e.push(i)}e.sort()}else if(!this.multiple&&this.value){let s=t(this.value,this.niceValueType);s&&e.push(s)}return e},niceValues:function(){let e=[];for(let t=0;t<this.niceItems.length;++t)this.niceItems[t].disabled||e.push(this.niceItems[t].value);return e.sort(),e},niceItems:function(){let e=[];if(!Array.isArray(this.items)||!this.items.length)return e;let s={},l=[],n={},r=!1,o=!1,c=!1;for(let a=0;a<this.items.length;++a){let h={group:"",label:"string"===this.niceLabelType?"":0,value:"string"===this.niceValueType?"":0,disabled:this.disabled,placeholder:!1,selected:!1};"object"==typeof this.items[a]?(h.group=i(this.items[a].group),h.label=t(this.items[a].label,this.niceLabelType),h.value=t(this.items[a].value,this.niceValueType),!h.label&&h.value&&(h.label=t(this.items[a].value,this.labelType)),!h.disabled&&this.items[a].disabled&&(h.disabled=!0)):(h.value=t(this.items[a],this.niceValueType),h.value&&(h.label=t(this.items[a],this.labelType))),h.value&&!n[h.value]&&(n[h.value]=!0,h.disabled||!this.init||c&&!this.multiple||-1===this.niceValue.indexOf(h.value)||(h.selected=!0,c=!0),h.group?(void 0===s[h.group]&&(s[h.group]=[],l.push(h.group),r=!0),s[h.group].push(h)):(o=!0,e.push(h)))}if(1<l.length&&this.sortDirection&&(l.sort(),"DESC"===this.sortDirection&&l.reverse()),this.placeholder&&!this.required){let t={group:"",label:this.labelPlaceholder,value:"string"===this.niceValueType?"":0,disabled:this.disabled,placeholder:!0,selected:!1};o||!r?e.unshift(t):(t.group=l[0],s[l[0]].unshift(t))}if(this.sortDirection){if(1<e.length&&e.sort(this.sortFunction),l.length)for(let t=l.length-1;0<=t;--t){1<s[l[t]].length&&s[l[t]].sort(this.sortFunction);for(let i=s[l[t]].length-1;0<=i;--i)e.unshift(s[l[t]][i])}}else if(l.length)for(let t=l.length-1;0<=t;--t)for(let i=s[l[t]].length-1;0<=i;--i)e.unshift(s[l[t]][i]);if(!e.length){if(!this.init){let e;e=this.multiple?[]:"string"===this.niceValueType?"":0,this.init=!0,this.$emit("input",e)}return e}if(!this.init){let s=a(this.value);if(this.multiple)if(Array.isArray(s)){let e=[];for(let i=0;i<s.length;++i){let l=t(s[i],this.niceValueType);l&&n[l]&&-1===e.indexOf(l)&&e.push(l)}s=e}else s=[];else(s=t(s,this.niceValueType))&&n[s]||(s="string"===this.niceValueType?"":0);if(this.multiple&&s.length||!this.multiple&&s){let t=[];for(let i=0;i<e.length;++i)if(this.multiple){if(-1!==s.indexOf(e[i].value)&&(e[i].disabled?s.splice(s.indexOf(e[i].value),1):(t.push(e[i].value),e[i].selected=!0),s.length===t.length))break}else if(s===e[i].value){e[i].disabled?s="string"===this.niceValueType?"":0:(t.push(e[i].value),e[i].selected=!0);break}this.multiple?t.length!==s.length&&(s=t).sort():s&&!t.length&&(s="string"===this.niceValueType?"":0)}if(!s&&this.placeholder&&!this.required)for(let t=0;t<e.length;++t)if(e[t].placeholder){e[t].selected=!0;break}this.init=!0,this.$emit("input",s)}return e},blobItems:function(){let e=[],t="",s=0;const i=this.search&&this.searchValue,l=i?RegExp(f(this.searchValue),"i"):"",n=i?RegExp(f(this.searchValue),"gi"):"";let r=0;for(let o=0;o<this.niceItems.length;++o){++s,this.niceItems[o].group&&t!==this.niceItems[o].group&&(t=this.niceItems[o].group,e.push({class:"blobselect-item-group",disabled:!1,label:this.niceItems[o].group,richLabel:this.niceItems[o].group,placeholder:!1,selected:!1,tabIndex:s,value:!1}),++s);let c=this.niceItems[o].label,a=["blobselect-item"];this.niceItems[o].group&&a.push("has-group"),this.niceItems[o].disabled&&a.push("is-disabled"),this.niceItems[o].placeholder&&a.push("is-placeholder"),this.niceItems[o].selected&&a.push("is-active"),i&&(l.test(this.niceItems[o].label)?(a.push("is-match"),c=c.replace(n,"<mark>$&</mark>"),++r):a.push("is-not-match")),e.push({class:a.join(" "),disabled:this.niceItems[o].disabled,label:this.niceItems[o].label,richLabel:c,placeholder:this.niceItems[o].placeholder,selected:this.niceItems[o].selected,tabIndex:this.niceItems[o].label,value:this.niceItems[o].value})}if(i&&!r)for(let t=0;t<e.length;++t)e[t].class=e[t].class.replace(" is-not-match","");return e},selectItems:function(){let e="",t="";for(let s=0;s<this.niceItems.length;++s){this.niceItems[s].group&&this.niceItems[s].group!==t?(t&&(e+="</optgroup>"),e+='<optgroup label="'+p(this.niceItems[s].group)+'">',t=this.niceItems[s].group):t&&(e+="</optgroup>",t="");let i='<option value="'+p(this.niceItems[s].value)+'"';this.niceItems[s].disabled?i+=" disabled":this.niceItems[s].selected&&(i+=" selected"),e+=i+=">"+p(this.niceItems[s].label)+"</option>"}return t&&(e+="</optgroup>"),e},selectedItems:function(){let e=[];for(let t=0;t<this.niceItems.length;++t)this.niceItems[t].selected&&!this.niceItems[t].disabled&&e.push({label:this.niceItems[t].placeholder?this.fieldPlaceholder:this.niceItems[t].label,value:this.niceItems[t].value,class:"blobselect-selection"+(this.niceItems[t].placeholder?" is-placeholder":"")});return e},sortDirection:function(){return!(!this.sort||"string"!=typeof this.sort)&&("D"===this.sort.toUpperCase().substr(0,1)?"DESC":"ASC")},sortFunction:function(){if(!1===this.sortDirection)return!1;switch(this.niceLabelType+this.sortDirection){case"numberASC":return r;case"numberDESC":return o;case"stringASC":return l;case"stringDESC":return n}return!1},stateClass:function(){return this.state&&"closed"!==this.state?"is-"+this.state:"is-closed"}},template:'<div class="blobselect" v-on:keyup="toggleKeyState($event)" :tabIndex.prop="0" v-on:click.self="toggleState" :class="[ stateClass, { \'is-disabled\' : disabled, \'is-required\' : required, \'is-multiple\' : multiple }]" >\t\t\t<div class="blobselect-selections" v-if="multiple" v-on:click.self.prevent="toggleState">\t\t\t\t<div v-if="selectedItems.length" v-for="item in selectedItems" v-on:click.prevent="toggleSelection(item.value)" :class="item.class">{{ item.label }}</div>\t\t\t\t<div v-if="!selectedItems.length && placeholder" class="blobselect-selection is-placeholder" v-on:click.prevent="toggleState">{{ fieldPlaceholder }}</div>\t\t\t</div>\t\t\t<div class="blobselect-selections" v-else v-on:click.prevent="toggleState">\t\t\t\t<div v-if="selectedItems.length" v-for="item in selectedItems" :class="item.class">{{ item.label }}</div>\t\t\t\t<div v-if="!selectedItems.length && placeholder" class="blobselect-selection is-placeholder">{{ fieldPlaceholder }}</div>\t\t\t</div>\t\t\t<select v-on:click.self="toggleState" :multiple="multiple" :disabled="disabled" :required="required" :name="niceName" :id="niceId" v-html="selectItems" v-on:input="$emit(\'input\', $event.target.value)"></select>\t\t\t</select>\t\t\t<div class="blobselect-button" v-on:click.prevent="toggleState"></div>\t\t\t<div class="blobselect-items">\t\t\t\t<div v-if="search" class="blobselect-item-search" type="text" contentEditable v-on:input="toggleFilter($event.target.textContent)" v-on:click="resetFocus" tabIndex="0"></div>\t\t\t\t<div v-for="(item, index) in blobItems" :class="[item.class, { \'is-focused\' : index === focus }]" :tabIndex.prop="item.tabIndex" v-on:click.prevent="toggleSelection(item.value)" v-html="item.richLabel"></div>\t\t\t</div>\t\t</div>'},t=function(e,t){return"number"===t?s(e):i(e)},s=function(e){if(!e||"boolean"==typeof e)return e?1:0;if("number"!=typeof e)try{e=Number(e)||0}catch(t){e=0}return e},i=function(e){if(!e||"boolean"==typeof e)return e?"true":"";if("string"!=typeof e)try{e=String(e)}catch(t){e=""}return e},l=function(e,t){if(e.placeholder===t.placeholder){return e.label.toLowerCase()<t.label.toLowerCase()?-1:1}return e.placeholder?-1:1},n=function(e,t){if(e.placeholder===t.placeholder){return e.label.toLowerCase()>t.label.toLowerCase()?-1:1}return e.placeholder?-1:1},r=function(e,t){if(e.placeholder===t.placeholder){return(Number(e.label.replace(/[^\d.]/g,""))||0)<(Number(t.label.replace(/[^\d.]/g,""))||0)?-1:1}return e.placeholder?-1:1},o=function(e,t){if(e.placeholder===t.placeholder){return(Number(e.label.replace(/[^\d.]/g,""))||0)>(Number(t.label.replace(/[^\d.]/g,""))||0)?-1:1}return e.placeholder?-1:1},c={8:"backspace",9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down"},a=function(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},h=function(e){const t=document.querySelectorAll(".blobselect.is-open");for(let s=0;s<t.length;++s)e&&e===t[s]||void 0!==t[s].__vue__&&t[s].__vue__.toggleState("close")},u=function(e){let t,s=document.createRange();s.selectNodeContents(e),s.collapse(!1),(t=window.getSelection()).removeAllRanges(),t.addRange(s)},p=function(e){return"string"!=typeof e&&(e=i(e)),e.replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},d=function(e){return 47<e&&58>e||64<e&&91>e||95<e&&112>e||185<e&&193>e||218<e&&223>e},f=function(e){try{return(e+="").replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}catch(e){return""}};document.documentElement.addEventListener("click",function(e){if("matches"in e.target){if(e.target.matches(".blobselect"))return!0;let t=e.target;for(;t.parentNode&&"matches"in t.parentNode;)if((t=t.parentNode).matches(".blobselect"))return!0;h()}return!0}),"undefined"!=typeof window&&window.Vue&&window.Vue.component("blob-select",e)}();