!function(){const e={data:function(){return{focus:0,init:!1,minItemKey:0,maxItemKey:0,searchValue:"",state:"closed",timeout:null}},props:{id:{type:String,default:""},name:{type:String,default:""},value:{type:[Number,String,Array],default:0},items:{type:Array,default:[]},disabled:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},placeholder:{type:Boolean,default:!1},required:{type:Boolean,default:!1},search:{type:Boolean,default:!1},sort:{type:String,default:""},fieldPlaceholder:{type:String,default:"---"},labelPlaceholder:{type:String,default:"---"},labelType:{type:String,default:"string"},valueType:{type:String,default:"string"}},methods:{toggleState:function(e){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.state="open"),this.disabled?e="closed":(!e||"open"!==e&&"closed"!==e)&&(e="closed"===this.state?"open":"closed"),e!==this.state)if("open"===e){h(this.$el),this.state="opening";let e=this;this.timeout=setTimeout(function(){if(e.state="open",e.timeout=null,e.search){const t=e.$el.querySelector(".blobselect-item-search");t.innerHTML=e.searchValue,d(t)}e.resetFocus()},50)}else this.state="closed",this.$el.focus()},toggleKeyState:function(e){const t=e.keyCode,s=c[t]||!1;if("open"!==this.state)(!s||"tab"!==s&&"backspace"!==s)&&(e.stopPropagation(),this.search&&f(t)&&(this.searchValue+=String.fromCharCode(t).toLowerCase(),this.$el.querySelector(".blobselect-item-search").textContent=this.searchValue),"closed"===this.state&&this.toggleState("open"));else if("escape"===s)e.stopPropagation(),this.toggleState("closed");else if("enter"===s)e.stopPropagation(),e.preventDefault(),e.target.classList.contains("blobselect-item-search")?this.selectFirst():this.selectFocused();else if(-1!==["tab","up","down","left","right"].indexOf(s)){if(e.target.classList.contains("blobselect-item-search")&&("left"===s||"right"===s))return!0;e.stopPropagation(),"left"===s||"up"===s?this.traverseItems("back"):this.traverseItems("next")}else this.search&&e.target.classList.contains("blobselect-item-search")&&this.toggleFilter()},toggleFilter:function(e,t,s){let l,i,n,o,a=!0;function r(){n=e.apply(i||this,l||[]),i=l=null,a=!0}function c(){o&&(clearTimeout(o),o=null)}function u(){i=this,l=arguments,s?a&&(a=!1,o=setTimeout(r,t)):(c(),o=setTimeout(r,t))}return u.cancel=c,u}(function(){if(!this.search)return;const e=this.$el.querySelector(".blobselect-item-search");if(null===e)return;this.searchValue=e.textContent.replace(/\s{1,}/g," ").trim(),-1!==this.focus&&(this.focus=-1,this.resetFocus());let s={},l=new Set;if(this.searchValue){const e=this.niceItems,t=e.length,i=RegExp(p(this.searchValue),"i"),n=RegExp(p(this.searchValue),"gi");for(let o=0;o<t;++o)i.test(e[o].label)&&(s[e[o].label]={label:e[o].label,richLabel:b(e[o].label).replace(n,"<mark>$&</mark>")},l.add(e[o].label))}const i=this.$el.querySelectorAll(".blobselect-item"),n=i.length,o=0<l.size;for(let e=0;e<n;++e){const n=t(JSON.parse(i[e].getAttribute("data-blob-label"))||!1,this.niceLabelType);if(l.has(n))i[e].classList.contains("is-match")||i[e].classList.add("is-match"),i[e].classList.contains("is-not-match")&&i[e].classList.remove("is-not-match"),i[e].innerHTML=s[n].richLabel;else{let t=!1;i[e].classList.contains("is-match")&&(i[e].classList.remove("is-match"),t=!0),o?i[e].classList.contains("is-not-match")||i[e].classList.add("is-not-match"):i[e].classList.contains("is-not-match")&&i[e].classList.remove("is-not-match"),t&&(i[e].textContent=n)}}},150),traverseItems:function(e){let t=this.getItemKey(e);t!==this.focus&&(this.focus=t,this.triggerFocus())},getItemKey:function(e){if(!this.minItemKey&&!this.maxItemKey)return-1;if("current"===e){const e=this.$el.querySelector(".blobselect-item.is-selected");if(null!==e){const t=parseInt(e.getAttribute("data-blob-item"))||0;if(t)return t}return this.getItemKey("first")}const t=this.$el.querySelectorAll(".blobselect-item:not(.is-disabled):not(.is-not-match)"),s=t.length;if(!s)return-1;let l=[];for(let e=0;e<s;++e){let s=parseInt(t[e].getAttribute("data-blob-item"))||0;l.push(s)}l.sort(function(e,t){return e-t});const i=l.length;let n=0;const o=l[0],a=l[i-1];if(1===i)return o;switch(e){case"next":if((n=this.focus+1)>a)return o;if(n===a)return a;for(let e=0;e<i;++e)if(l[e]>=n)return l[e];return o;case"back":if((n=this.focus-1)<o)return a;if(n===o)return o;for(let e=i-1;0<=e;--e)if(l[e]<=n)return l[e];return a;case"first":return o;case"last":return a}return-1},resetFocus:function(){if(0<=this.focus){let e=this.search?-1:this.getItemKey("first");e!==this.focus&&(this.focus=e,this.triggerFocus())}},triggerFocus:function(){if(0>this.focus)this.search&&this.$el.querySelector(".blobselect-item-search").focus();else{let e=this.search?this.focus+1:this.focus;const t=this.$el.querySelector('.blobselect-item[data-blob-item="'+e+'"]');null!==t?t.focus():(this.focus=-1,this.search&&this.$el.querySelector(".blobselect-item-search").focus())}},itemsClick:function(e){if(e.target.classList.contains("blobselect-item"))return e.preventDefault(),this.toggleFieldSelection(e.target);let t=e.target;for(;t.parentNode&&"classList"in t.parentNode;){if((t=t.parentNode).classList.contains("blobselect-item"))return this.toggleFieldSelection(t);if(t.classList.contains("blobselect"))return}},toggleFieldSelection:function(e){if(!e.classList.contains("blobselect-item")||e.classList.contains("is-disabled"))return;const s=t(JSON.parse(e.getAttribute("data-blob-value"))||!1,this.niceValueType);this.toggleValueSelection(s)},toggleValueSelection:function(e){e=t(e||"",this.niceValueType);let s=!1,l=u(this.value);if(this.multiple){let t=l.indexOf(e);-1!==t?(l.splice(t,1),s=!0):e&&(l.push(e),l.sort(),s=!0)}else e!==l&&(l=e,s=!0);s&&this.$emit("input",l);let i=this;Vue.nextTick(function(){"open"!==i.state||e&&!i.niceValue.has(e)||i.toggleState("closed")})},selectFirst:function(){let e=this.getItemKey("first");if(0>e)return;const t=this.$el.querySelector('.blobselect-item[data-blob-item="'+e+'"]');null!==t&&this.toggleFieldSelection(t)},selectFocused:function(){const e=this.$el.querySelector(".blobselect-item.is-focused");null!==e&&this.toggleFieldSelection(e)}},computed:{niceName:function(){let e=this.name;return e&&"string"==typeof e||(e="blobselect"),this.multiple&&"[]"!==e.substr(-2)&&(e+="[]"),e},niceId:function(){let e=this.id;return e&&"string"==typeof e||(e=this.niceName.replace(/[\[\]]/g,"")),e},niceLabelType:function(){return this.labelType&&"string"==typeof this.labelType&&"num"===this.labelType.toLowerCase().substr(0,3)?"number":"string"},niceValueType:function(){return this.valueType&&"string"==typeof this.valueType&&"num"===this.valueType.toLowerCase().substr(0,3)?"number":"string"},nicePlaceholderValue:function(){return"string"===this.niceValueType?"":0},nicePlaceholderLabel:function(){return"string"===this.niceLabelType?"":0},niceValue:function(){let e;const s=this.itemValues,l=JSON.stringify(this.value);if(this.multiple){if(e=[],Array.isArray(this.value))for(let l=0;l<this.value.length;++l){let i=t(this.value[l],this.niceValueType);i&&-1===e.indexOf(i)&&s.has(i)&&e.push(i)}e.sort()}else(e=t(this.value,this.niceValueType))&&!s.has(e)&&(e=this.nicePlaceholderValue);if(JSON.stringify(e)!==l&&this.$emit("input",e),!this.multiple){if(e===this.nicePlaceholderValue)return new Set;e=[e]}return new Set(e)},valueHash:function(){let e=Array.from(this.niceValue);return e.sort(),i(e)},niceItems:function(){if(!Array.isArray(this.items))return[];const e=this.items.length;let s=[],i=new Set;for(let n=0;n<e;++n){let e={group:"",label:this.nicePlaceholderLabel,value:this.nicePlaceholderValue,disabled:this.disabled,placeholder:!1};"object"==typeof this.items[n]?(this.items[n].group&&(e.group=l(this.items[n].group)),e.label=t(this.items[n].label,this.niceLabelType),e.value=t(this.items[n].value,this.niceValueType),!e.label&&e.value&&(this.niceLabelType!==this.niceValueType?e.label=t(e.value,this.niceLabelType):e.label=e.value),!e.disabled&&this.items[n].disabled&&(e.disabled=!0)):(e.value=t(this.items[n],this.niceValueType),e.value&&(this.niceLabelType!==this.niceValueType?e.label=t(e.value,this.niceLabelType):e.label=e.value)),e.value&&!i.has(e.value)&&(i.add(e.value),s.push(e))}return s},itemValues:function(){let e=this.enabledItems.map(function(e){return e.value});return e.sort(),new Set(e)},enabledItems:function(){return this.niceItems.filter(function(e){return!e.disabled})},groupedItems:function(){let e=this.niceItems.filter(function(e){return!!e.group});const t=e.length;if(!t)return!1;let s={},l=new Set;for(let i=0;i<t;++i){let t=e[i].group;l.has(t)||(l.add(t),s[t]=[]),s[t].push(e[i])}if(this.sortDirection){let e=Object.keys(s),t=e.length;for(let l=0;l<t;++l)s[e[l]].sort(this.sortFunction)}return s},ungroupedItems:function(){let e=this.niceItems.filter(function(e){return!e.group});return!!e.length&&(this.sortDirection&&e.sort(this.sortFunction),e)},selectedItems:function(){const e=this.niceValue,t=this;let s=this.enabledItems.filter(function(t){return e.has(t.value)}).map(function(e){return{label:e.placeholder?t.fieldPlaceholder:e.label,value:e.value,class:"blobselect-selection"+(e.placeholder?" is-placeholder":"")}});return this.sortDirection&&s.sort(this.sortFunction),s},hasSelections:function(){return 0<this.selectedItems.length},selectHtml:function(){let e="";const t=this.niceValue;!this.placeholder||this.multiple||this.required||(e+='<option value="'+this.nicePlaceholderValue+'">'+b(this.labelPlaceholder)+"</option>");const s=this.groupedItems;if(!1!==s){let l=Object.keys(this.groupedItems);const i=l.length;this.sortDirection&&(l.sort(),"DESC"===this.sortDirection&&l.reverse());for(let n=0;n<i;++n){e+='<optgroup label="'+b(l[n])+'">';const i=s[l[n]].length;for(let o=0;o<i;++o)e+='<option value="'+b(s[l[n]][o].value)+'"',s[l[n]][o].disabled&&(e+=" disabled"),t.has(s[l[n]][o].value)&&(e+=" selected"),e+=">"+b(s[l[n]][o].label)+"</option>";e+="</optgroup>"}}const l=this.ungroupedItems;if(!1!==l){const s=l.length;for(let i=0;i<s;++i)e+='<option value="'+b(l[i].value)+'"',l[i].disabled&&(e+=" disabled"),t.has(l[i].value)&&(e+=" selected"),e+=">"+b(l[i].label)+"</option>"}return e},itemsHtml:function(){let e="";this.search&&(e+='<div class="blobselect-item-search" type="text" contentEditable tabIndex="0"></div>');let t=0;if(this.placeholder&&!this.multiple&&!this.required){++t;let s=this.labelPlaceholder,l=this.nicePlaceholderValue;e+='<div class="'+["blobselect-item","is-placeholder"].join(" ")+'" tabIndex="'+t+'" data-blob-item="'+t+'" data-blob-value="'+b(JSON.stringify(l))+'" data-blob-label="'+b(JSON.stringify(s))+'">'+b(s)+"</div>"}const s=this.groupedItems;if(!1!==s){let l=Object.keys(this.groupedItems);const i=l.length;this.sortDirection&&(l.sort(),"DESC"===this.sortDirection&&l.reverse());for(let n=0;n<i;++n){e+='<div class="blobselect-item-group">'+b(l[n])+"</div>";const i=s[l[n]].length;for(let o=0;o<i;++o){++t;let i=s[l[n]][o].label,a=s[l[n]][o].value,r=["blobselect-item","has-group"];s[l[n]][o].disabled&&r.push("is-disabled"),s[l[n]][o].placeholder&&r.push("is-placeholder"),e+='<div class="'+r.join(" ")+'" tabIndex="'+t+'"',e+=' data-blob-item="'+t+'"',e+=' data-blob-value="'+b(JSON.stringify(a))+'" data-blob-label="'+b(JSON.stringify(i))+'">'+b(i)+"</div>"}}}const l=this.ungroupedItems;if(!1!==l){const s=l.length;for(let i=0;i<s;++i){++t;let s=l[i].label,n=l[i].value,o=["blobselect-item"];l[i].disabled&&o.push("is-disabled"),l[i].placeholder&&o.push("is-placeholder"),e+='<div class="'+o.join(" ")+'" tabIndex="'+t+'"',e+=' data-blob-item="'+t+'"',e+=' data-blob-value="'+b(JSON.stringify(n))+'" data-blob-label="'+b(JSON.stringify(s))+'">'+b(s)+"</div>"}}return t?(this.minItemKey=1,this.maxItemKey=t):(this.minItemKey=0,this.maxItemKey=0),e},sortDirection:function(){return!(!this.sort||"string"!=typeof this.sort)&&("D"===this.sort.toUpperCase().substr(0,1)?"DESC":"ASC")},sortFunction:function(){if(!1===this.sortDirection)return!1;switch(this.niceLabelType+this.sortDirection){case"numberASC":return a;case"numberDESC":return r;case"stringASC":return n;case"stringDESC":return o}return!1},stateClass:function(){return this.state&&"closed"!==this.state?"is-"+this.state:"is-closed"}},watch:{focus:function(e){const t=this.$el.querySelectorAll(".blobselect-item.is-focused");for(let e=0;e<t.length;++e)t[e].classList.remove("is-focused");if(0<e){const t=this.$el.querySelector('.blobselect-item[data-blob-item="'+e+'"]');null!==t&&t.classList.add("is-focused")}},valueHash:function(){if(!this.niceValue.size){const e=this.$el.querySelectorAll(".blobselect-item.is-active"),t=e.length;if(t)for(let s=0;s<t;++s)!e[s].classList.contains("is-disabled")&&e[s].classList.contains("is-placeholder")||e[s].classList.remove("is-active");const s=this.$el.querySelectorAll(".blobselect-item.is-placeholder:not(.is-active):not(.is-disabled)"),l=s.length;for(let e=0;e<l;++e)s[e].classList.add("is-active");return}const e=this.$el.querySelectorAll(".blobselect-item"),s=e.length,l=this.niceValue;let i=!1;for(let n=0;n<s;++n)i&&!this.multiple||e[n].classList.contains("is-disabled")||!l.has(t(JSON.parse(e[n].getAttribute("data-blob-value"))||!1,this.niceValueType))?e[n].classList.contains("is-active")&&e[n].classList.remove("is-active"):(e[n].classList.contains("is-active")||e[n].classList.add("is-active"),i=!0)}},template:'<div class="blobselect" v-on:keyup="toggleKeyState($event)" :tabIndex.prop="0" v-on:click.self="toggleState" :class="[ stateClass, { \'is-disabled\' : disabled, \'is-required\' : required, \'is-multiple\' : multiple }]" >\t\t\t<div class="blobselect-selections" v-if="multiple" v-on:click.self.prevent="toggleState">\t\t\t\t<div v-if="hasSelections" v-for="item in selectedItems" v-on:click.prevent="toggleValueSelection(item.value)" :class="item.class">{{ item.label }}</div>\t\t\t\t<div v-if="!hasSelections && placeholder" class="blobselect-selection is-placeholder" v-on:click.prevent="toggleState">{{ fieldPlaceholder }}</div>\t\t\t</div>\t\t\t<div class="blobselect-selections" v-else v-on:click.prevent="toggleState">\t\t\t\t<div v-if="hasSelections" v-for="item in selectedItems" :class="item.class">{{ item.label }}</div>\t\t\t\t<div v-if="!hasSelections && placeholder" class="blobselect-selection is-placeholder">{{ fieldPlaceholder }}</div>\t\t\t</div>\t\t\t<select v-on:click.self="toggleState" :multiple="multiple" :disabled="disabled" :required="required" :name="niceName" :id="niceId" v-html="selectHtml" v-on:input="$emit(\'input\', $event.target.value)"></select>\t\t\t</select>\t\t\t<div class="blobselect-button" v-on:click.prevent="toggleState"></div>\t\t\t<div class="blobselect-items" v-on:click="itemsClick($event)" v-html="itemsHtml"></div>\t\t</div>'},t=function(e,t){return"number"===t?s(e):l(e)},s=function(e){if(!e||"boolean"==typeof e)return e?1:0;if("number"!=typeof e)try{e=Number(e)||0}catch(t){e=0}return e},l=function(e){if(!e||"boolean"==typeof e)return e?"true":"";if("string"!=typeof e)try{e=String(e)}catch(t){e=""}return e},i=function(e){if("object"==typeof e)try{e=JSON.stringify(e)}catch(e){return 0}else try{e+=""}catch(e){return 0}let t=0;const s=e.length;for(let l=0;l<s;++l){t=(t<<5)-t+e.charCodeAt(l),t&=t}return t},n=function(e,t){if(e.placeholder===t.placeholder){let s=e.label.toLowerCase(),l=t.label.toLowerCase();return s===l?0:s<l?-1:1}return e.placeholder?-1:1},o=function(e,t){if(e.placeholder===t.placeholder){let s=e.label.toLowerCase(),l=t.label.toLowerCase();return s===l?0:s>l?-1:1}return e.placeholder?-1:1},a=function(e,t){if(e.placeholder===t.placeholder){let s=Number(e.label.replace(/[^\d.]/g,""))||0,l=Number(t.label.replace(/[^\d.]/g,""))||0;return s===l?0:s<l?-1:1}return e.placeholder?-1:1},r=function(e,t){if(e.placeholder===t.placeholder){let s=Number(e.label.replace(/[^\d.]/g,""))||0,l=Number(t.label.replace(/[^\d.]/g,""))||0;return s===l?0:s>l?-1:1}return e.placeholder?-1:1},c={8:"backspace",9:"tab",13:"enter",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down"},u=function(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},h=function(e){const t=document.querySelectorAll(".blobselect.is-open");for(let s=0;s<t.length;++s)e&&e===t[s]||void 0!==t[s].__vue__&&t[s].__vue__.toggleState("close")},d=function(e){let t,s=document.createRange();s.selectNodeContents(e),s.collapse(!1),(t=window.getSelection()).removeAllRanges(),t.addRange(s)},b=function(e){return"string"!=typeof e&&(e=l(e)),e.replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},f=function(e){return 47<e&&58>e||64<e&&91>e||95<e&&112>e||185<e&&193>e||218<e&&223>e},p=function(e){try{return(e+="").replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}catch(e){return""}};document.documentElement.addEventListener("click",function(e){if("matches"in e.target){if(e.target.matches(".blobselect"))return!0;let t=e.target;for(;t.parentNode&&"matches"in t.parentNode;)if((t=t.parentNode).matches(".blobselect"))return!0;h()}return!0}),"undefined"!=typeof window&&window.Vue&&window.Vue.component("blob-select",e)}();